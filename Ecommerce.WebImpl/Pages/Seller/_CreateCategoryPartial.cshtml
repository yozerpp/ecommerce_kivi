@using Ecommerce.Entity
@model Ecommerce.WebImpl.Pages.Seller._CreateCategoryPartial


<style>
    .category-form-section {
        background-color: #f8f9fa;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }
    .category-form-section:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .category-input-group {
        background: white;
        border-radius: 8px;
        border: 2px solid #e9ecef;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .category-input-group:focus-within {
        border-color: #495057;
        box-shadow: 0 0 0 0.2rem rgba(73, 80, 87, 0.25);
    }
</style>

<form data-id class="d-flex partial-parent flex-column gap-4 bg-white rounded-3 border">
    @Html.AntiForgeryToken()
    <script>
        ((s)=>{
            const parent = s.parentElement;
            document.addEventListener('DOMContentLoaded',load);
            parent.addEventListener('htmx:load', load);
            function load(e){
                if(e.type ==='htmx:load'){
                    e.stopPropagation();
                }
                parent.addEventListener('htmx:afterRequest', event=>{
                    if(!event.detail.successful)return;
                    event.detail.elt.dataset.id=event.detail.elt.querySelector('select[name="@(nameof(AddProduct.CreatedCategory)).@(nameof(Category.ParentId))"]').value;
                })
                const prompts = parent.lastElementChild.previousElementSibling.lastElementChild;
                parent.querySelector('select').addEventListener('change',(e)=>{
                    parent.dataset.id = e.currentTarget.value;
                });
                parent.querySelector('.propertyPrompts').dispatchEvent(new Event('htmx:load', {bubbles: false}));
                parent.lastElementChild.addEventListener('click', e=>{
                    e.preventDefault();
                    const formData = new FormData(parent);
                    prompts._prompts.forEach((p,i)=>{
                        const prefix = '@(nameof(AddProduct.CreatedCategory)).@(nameof(Category.CategoryProperties))[' +i + '].';
                        formData.append(prefix + '@(nameof(CategoryProperty.PropertyName))', p._inputName);
                        formData.append(prefix + '@(nameof(CategoryProperty.IsRequired))', p._required);
                        if(p._dataType==='number'){
                            formData.append(prefix + '@(nameof(CategoryProperty.IsNumber))', 'true');
                            formData.append(prefix + '@(nameof(CategoryProperty.MinValue))', p._constraint.min.toString());
                            formData.append(prefix + '@(nameof(CategoryProperty.MaxValue))', p._constraint.max.toString());
                        } else if(p._dataType==='enum'){
                            formData.append(prefix + '@(nameof(CategoryProperty.EnumValues))', p._constraint)
                        }
                    })
                    htmx.ajax('POST', '/Seller/AddProduct?handler=category&getTemplate=@(Model.ForProductTemplate)', {
                        target: '@Model.Target',
                        swap: 'innerHTML', 
                        values: Object.fromEntries(formData.entries()),
                        source: parent,
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        }
                    });
                })
                console.log('loaded @(nameof(_CreateCategoryPartial)) from ' + e.type);
            }
        })(document.currentScript)
        //# sourceURL=CreateCategoryPartial.js
    </script>
    
    <div class="category-form-section">
        <div class="d-flex align-items-center mb-3">
            <div class="bg-light rounded-circle p-2 me-3 border">
                <i class="fas fa-tag text-dark"></i>
            </div>
            <h6 class="fw-semibold mb-0 text-dark">Kategori Bilgileri</h6>
        </div>
        <div class="category-input-group">
            <label class="input-group-text fw-semibold bg-light text-dark border-0">Kategori İsmi</label>
            <input name="@(nameof(AddProduct.CreatedCategory)).@(nameof(Category.Name))" type="text" class="form-control border-0" required/>    
        </div>
    </div>
    
    <div class="category-form-section">
        <label class="fw-semibold text-dark mb-3 d-block">Kategori Açıklaması</label>
        <textarea name="@(nameof(AddProduct.CreatedCategory)).@(nameof(Category.Description))" type="text" class="form-control border-2 rounded-3" rows="4" required></textarea>    
    </div>
    
    <div class="category-form-section">
        <label class="fw-semibold text-dark mb-3 d-block">Üst Kategori</label>
        <select name="@(nameof(AddProduct.CreatedCategory)).@(nameof(Category.ParentId))" class="form-select border-2 rounded-3">
                <option>Yok</option>
            @foreach (var category in Model.Categories){
                <div class="d-inline-flex gap-2">
                    <i class="bi bi-option"></i><option value="@(category.Id)">@(category.Name)</option>
                </div>
            }
        </select>
    </div>
    
    <div class="category-form-section">
        <label class="fw-semibold text-dark mb-3 d-block">Kategori Özelliklerini Belirle</label>
        @await Html.PartialAsync("_PropertyPromptsPartial")
    </div>
    
    <div class="text-center">
        <button type="button" class="btn btn-dark btn-lg rounded-3 fw-semibold px-5 py-3">
            <i class="fas fa-plus me-2"></i>Kategori Oluştur
        </button>
    </div>
</form>
