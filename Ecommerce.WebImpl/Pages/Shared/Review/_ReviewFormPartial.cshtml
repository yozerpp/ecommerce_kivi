@using Ecommerce.Entity
@model Ecommerce.WebImpl.Pages.Shared.Review._ReviewFormPartial
<div class="mb-4 partial-parent" >
    <script>
    document.addEventListener('DOMContentLoaded', load);
    document.addEventListener('htmx:load', load);
    function load() {
        const stars = document.querySelectorAll('.star-rating');
        const ratingInput = document.getElementById('ratingInput');

        stars.forEach((star, index) => {
            star.addEventListener('click', function() {
                const rating = index + 1;
                ratingInput.value = rating;

                stars.forEach((s, i) => {
                    if (i < rating) {
                        s.style.color = '#ffc107';
                        s.classList.remove('bi-star');
                        s.classList.add('bi-star-fill');
                    } else {
                        s.style.color = '#ddd';
                        s.classList.remove('bi-star-fill');
                        s.classList.add('bi-star');
                    }
                });
            });

            star.addEventListener('mouseenter', function() {
                const rating = index + 1;
                stars.forEach((s, i) => {
                    if (i < rating) {
                        s.style.color = '#ffc107';
                    } else {
                        s.style.color = '#ddd';
                    }
                });
            });
        });

        document.querySelector('.card').addEventListener('mouseleave', function() {
            const currentRating = parseInt(ratingInput.value);
            stars.forEach((s, i) => {
                if (i < currentRating) {
                    s.style.color = '#ffc107';
                    s.classList.remove('bi-star');
                    s.classList.add('bi-star-fill');
                } else {
                    s.style.color = '#ddd';
                    s.classList.remove('bi-star-fill');
                    s.classList.add('bi-star');
                }
            });
        });
    }
</script>
    <button class="btn btn-outline-primary d-flex align-items-center justify-content-start ms-3" type="button" data-bs-toggle="collapse" data-bs-target="#reviewFormCollapse" aria-expanded="false" aria-controls="reviewFormCollapse">
        <i class="bi bi-pencil-square me-2"></i>Değerlendirme Yaz
    </button>

    <div class="collapse mt-3">
        <div class="card">
            <div class="card-body">
                <form hx-post="/@nameof(Reviews)" hx-target="#popupResult" hx-swap="innerHTML">
                    <input type="hidden" name="@(nameof(Reviews.SentReview)).@(nameof(ProductReview.ProductId))" value="@Model.ProductId"/>
                    <input type="hidden" name="@(nameof(Reviews.SentReview)).@(nameof(ProductReview.SellerId))"/>
                    <div class="mb-3">
                        <label class="form-label">Puan</label>
                        <div class="d-flex gap-1 mb-2">
                            @for (int i = 1; i <= 5; i++){
                                <i class="bi bi-star star-rating" data-rating="@i" style="cursor: pointer; font-size: 1.5rem; color: #ddd;"></i>
                            }
                        </div>
                        <input type="hidden" name="@(nameof(Reviews.SentReview)).@(nameof(ProductReview.Rating))" id="ratingInput" value="0"/>
                    </div>

                    <div class="mb-3">
                        <label for="reviewContent" class="form-label">Yorumunuz</label>
                        <textarea class="form-control" name="@(nameof(Reviews.SentReview)).@(nameof(ProductReview.Comment))" rows="4" placeholder="Ürün hakkındaki deneyiminizi paylaşın..." maxlength="1000"></textarea>
                    </div>

                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send me-1"></i>Değerlendirmeyi Gönder
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

