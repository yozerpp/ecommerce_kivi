@using Ecommerce.Entity
@model _CommentPartial

<div>
    <div class="d-flex w-100 justify-content-between">
        <div>
            <h5 class="mb-1">@(Model.User != null ? Model.User.FirstName + ' ' + Model.User.LastName : Model.Name)</h5>
            <small>@(Utils.GetRelativeTime(Model.Created) ?? "şimdi")</small>
        </div>
        <p class="mb-1">@Model.Comment</p>
        <div>
            
        </div>
    </div>
    <div class="small d-flex row align-self-center justify-content-end">
        <a data-bs-toggle="tooltip" title="Cevapları Görüntüle" data-bs-placement="left" id="commentRepliesBtn@(Model.Id)" class="d-flex col-2 gap-1 p-0 text-decoration-none" href="javascript:void(0);" hx-trigger="click" hx-target="#commentReplies@(Model.Id)" hx-swap="innerHTML" hx-get="/@nameof(Reviews)?handler=comments&ParentId=@(Model.Id)&ReviewId=@(Model.ReviewId)&NestLevel=@(Model.NestLevel+1)">
            <i class="bi bg-light text-dark bi-chat-dots"></i>
        </a>
        <a onload="new bootstrap.Tooltip(event.currentTarget)" data-bs-placement="right" title="Cevapla" class="d-flex col-2 gap-1 p-0 text-decoration-none" href="" type="button" data-bs-toggle="collapse" data-bs-target="#replyComment@(Model.Id)" aria-expanded="false" aria-controls="replyComment@(Model.Id)">
            <i class="bg-light text-dark bi bi-reply"></i>
        </a>
    </div>
    <div class="collapse mt-3" id="replyComment@(Model.Id)">
        <form class="card card-body" hx-post="/@(nameof(Reviews))?handler=comment" method="post" hx-target="#commentReplyResult@(Model.Id)" hx-swap="innerHTML">
            <input type="hidden" name="SentComment.ReviewId" value="@Model.ReviewId"/>
            <input type="hidden" name="@(nameof(Reviews.SentComment)).@nameof(ReviewComment.ParentId)"/>
            <div class="row g-2">
                <div class="col-9 rounded-2 input-group mb-3">
                    <textarea class="small input-group-text form-control" style="font-size: unset" name="SentComment.Comment" placeholder="Cevaplayın"></textarea>
                </div>
                <div class="col-3">
                    <button type="submit" class="btn btn-primary">Gönder</button>
                </div>
            </div>
        </form>
        <div class="mt-3" hx-on::after-swap="setTimeout(()=>this.innerHTML='', 3000)" id="commentReplyResult@(Model.Id)"></div>
    </div>
    <div hx-on::after-swap="document.getElementById('commentRepliesBtn@(Model.Id)').remove()" id="commentReplies@(Model.Id)"></div>
</div>