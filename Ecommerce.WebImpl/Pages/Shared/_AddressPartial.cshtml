@using Ecommerce.Entity.Common
@model Ecommerce.WebImpl.Pages.Shared._AddressPartial

<!--
properties:
_line1: string
_line2: string
_district: string
_city: string
_country: string
_zipCode: string
_apiId: string
-->
<div class="address-container">
    <script>
        ((s)=>{
            const parent = s.parentElement;
            document.addEventListener('DOMContentLoaded', load);
            parent.addEventListener('htmx:load', load);
            function load(e) {
                if(e.type === 'htmx:load'){
                    e.stopPropagation();
                }
                
                const line1Input = parent.querySelector('input[name*="Line1"]');
                const line2Input = parent.querySelector('input[name*="Line2"]');
                const districtInput = parent.querySelector('input[name*="District"]');
                const cityInput = parent.querySelector('input[name*="City"]');
                const countryInput = parent.querySelector('input[name*="Country"]');
                const zipCodeInput = parent.querySelector('input[name*="ZipCode"]');
                
                // Initialize values from server-side model or input values
                parent._line1 = line1Input?.value || '@(Model?.Address?.Line1 ?? "")';
                parent._line2 = line2Input?.value || '@(Model?.Address?.Line2 ?? "")';
                parent._district = districtInput?.value || '@(Model?.Address?.District ?? "")';
                parent._city = cityInput?.value || '@(Model?.Address?.City ?? "")';
                parent._country = countryInput?.value || '@(Model?.Address?.Country ?? "")';
                parent._zipCode = zipCodeInput?.value || '@(Model?.Address?.ZipCode ?? "")';
                parent._apiId = '@(Model?.Address?.ApiId ?? "")';
                
                // Add event listeners for input changes
                function notifyAddressChange() {
                    // Dispatch custom event to notify parent CustomerAddressPartial
                    parent.dispatchEvent(new CustomEvent('addressChanged', { bubbles: true }));
                }
                
                if(line1Input) {
                    line1Input.addEventListener('input', (e) => {
                        parent._line1 = e.target.value;
                        notifyAddressChange();
                    });
                }
                if(line2Input) {
                    line2Input.addEventListener('input', (e) => {
                        parent._line2 = e.target.value;
                        notifyAddressChange();
                    });
                }
                if(districtInput) {
                    districtInput.addEventListener('input', (e) => {
                        parent._district = e.target.value;
                        notifyAddressChange();
                    });
                }
                if(cityInput) {
                    cityInput.addEventListener('input', (e) => {
                        parent._city = e.target.value;
                        notifyAddressChange();
                    });
                }
                if(countryInput) {
                    countryInput.addEventListener('input', (e) => {
                        parent._country = e.target.value;
                        notifyAddressChange();
                    });
                }
                if(zipCodeInput) {
                    zipCodeInput.addEventListener('input', (e) => {
                        parent._zipCode = e.target.value;
                        notifyAddressChange();
                    });
                }
            }
        })(document.currentScript)
        //# sourceURL=AddressPartial.js
    </script>
    @if (Model.AsInput){
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Adres Bilgileri</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Adres Satırı 1</label>
                        <input id="@(nameof(Address.Line1)+ '_' + (Model.Id ?? ""))" type="text" class="form-control" name="@(Model.InputPrefix ?? "").@(nameof(Address.Line1))" placeholder="Sokak, cadde, mahalle" value="@(Model?.Address?.Line1 ?? "")"/>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Adres Satırı 2</label>
                        <input id="@(nameof(Address.Line2)+ '_' + (Model.Id ?? ""))" type="text" class="form-control" name="@(Model.InputPrefix ?? "").@(nameof(Address.Line2))" placeholder="Apartman, daire no (opsiyonel)" value="@(Model?.Address?.Line2 ?? "")"/>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">İlçe</label>
                        <input id="@(nameof(Address.District) +'_'+ (Model.Id ?? ""))" type="text" class="form-control" name="@(Model.InputPrefix ?? "").@nameof(Address.District)" placeholder="İlçe" value="@(Model?.Address?.District ?? "")"/>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Şehir</label>
                        <input id="@(nameof(Address.City)+'_' + (Model.Id ?? ""))" class="form-control" type="text" name="@(Model.InputPrefix ?? "").@nameof(Address.City)" placeholder="Şehir" value="@(Model?.Address?.City ?? "")"/>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Ülke</label>
                        <input id="@(nameof(Address.Country) + '_' + (Model.Id ?? ""))" class="form-control" type="text" name="@(Model.InputPrefix ?? "").@nameof(Address.Country)" placeholder="Ülke" value="@(Model?.Address?.Country ?? "")"/>
                    </div>
                </div>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <label class="form-label">Posta Kodu</label>
                        <input id="@(nameof(Address.ZipCode)+ '_' + (Model.Id??""))" class="form-control" type="text" name="@(Model.InputPrefix??"").@(nameof(Address.ZipCode))" placeholder="Posta kodu" value="@(Model?.Address?.ZipCode ?? "")"/>
                    </div>
                </div>
            </div>
        </div>
    }
    else{
        <div class="card border-0 bg-light">
            <div class="card-body p-3">
                <div class="d-flex align-items-center mb-2">
                    <i class="bi bi-geo-alt me-2 text-primary"></i>
                    <h6 class="mb-0">Adres</h6>
                </div>
                <div class="row g-2">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">1.Satır :</small>
                            <span id="@(nameof(Address.Line1)+ '_' + (Model.Id ?? ""))" class="fw-medium">@Model.Address.Line1</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">2. Satır:</small>
                            <span id="@(nameof(Address.Line2)+ '_' + (Model.Id ??""))" class="fw-medium">@Model.Address.Line2</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col-md-4">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">İlçe:</small>
                            <span id="@(nameof(Address.District) +'_'+ (Model.Id ?? ""))" class="fw-medium">@Model.Address.District</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">Şehir:</small>
                            <span id="@(nameof(Address.City)+'_' + (Model.Id ?? ""))" class="fw-medium">@Model.Address.City</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">Ülke:</small>
                            <span id="@(nameof(Address.Country) + '_' + (Model.Id ?? ""))" class="fw-medium">@Model.Address.Country</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                </div>
                <div class="row g-2 mt-1">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <small class="text-muted me-2">Posta Kodu:</small>
                            <span id="@(nameof(Address.ZipCode)+ '_' + (Model.Id??""))" class="fw-medium">@Model.Address.ZipCode</span>
                            @if (Model.Editable){
                                @await Html.PartialAsync(nameof(_EditablePartial), new _EditablePartial())
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
