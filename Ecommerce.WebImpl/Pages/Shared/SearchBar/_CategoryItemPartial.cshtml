@model (string,string,Ecommerce.Entity.Category, HashSet<Ecommerce.Entity.Category>)
@{
    var (onClickHandler, rootId,category, visited)= Model;
}

<li class="list-unstyled rounded-end-1 shadow-sm overflow-x-visible overflow-y-visible">
    <script>
        @if (category.Children.Count > 0){
            <text>
            let childrenElement@(rootId)@(category.Id);
            @if (category.ParentId != null){
                <text>
                   const parent@(rootId)@(category.Id) = document.getElementById('Children@(rootId)@(category.ParentId)');
                </text>
            }
            else{
                <text>
                    const parent@(rootId)@(category.Id) = document.currentScript.parentElement.parentElement;
                </text>
            }

            document.addEventListener("DOMContentLoaded", () => {
                childrenElement@(rootId)@(category.Id) = new bootstrap.Collapse(document.getElementById('Children@(rootId)@(category.Id)'), { toggle: false, parent: parent });
            });
            </text>
        }
        </script>
    <ul class="p-0 list-unstyled position-relative"
        onmouseenter="@(category.Children.Count > 0?$"childrenElement{rootId}{category.Id}.show();":";")event.currentTarget.classList.add('bg-light');"
        onmouseleave="@(category.Children.Count > 0?$"childrenElement{rootId}{category.Id}.hide();":";")event.currentTarget.classList.remove('bg-light');"
        class="rounded-end-1 p-2" style="cursor: pointer">
        <li data-id="@(category.Id)" data-name="@(category.Name)" onclick="event.preventDefault();@Html.Raw(onClickHandler??"")" class="rounded-end-1 p-4" style="cursor: pointer">
            <p class="m-0 fs-5 small fw-bold">@category.Name</p>
        </li>
        @if (category.Children.Count > 0){
            <li id="Children@(rootId)@(category.Id)" class="collapse bg-white rounded-0 position-absolute top-0 start-100">
                <ul class="list-unstyled">
                    @foreach (var cat in category.Children){
                        if (visited.Add(cat)){
                            @await Html.PartialAsync("Shared/SearchBar/_CategoryItemPartial", (onClickHandler, rootId, cat, visited))
                        }
                    }
                </ul>
            </li>
        }
    </ul>
</li>    
