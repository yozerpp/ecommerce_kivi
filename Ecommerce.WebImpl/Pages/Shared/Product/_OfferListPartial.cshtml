@using Ecommerce.Entity.Views
@model Ecommerce.WebImpl.Pages.Shared.Product._OfferListPartial
<ul class="list-group row flex-grow-0 overflow-auto partial-parent">
    <script>
        ((s) => {
            document.addEventListener("DOMContentLoaded", load);
            s.parentElement.addEventListener("htmx:load", load);
            
            function load(e) {
                if (e.type === 'htmx:load') {
                    e.stopPropagation();
                }
                const parent = s.parentElement;
                parent._selectedSellerId = null;
                
                parent.querySelectorAll('.offer-item').forEach(item => {
                    item.addEventListener('click', function(event) {
                        // Remove previous selection
                        parent.querySelector('.bg-light')?.classList?.remove('bg-light');
                        
                        // Add selection to current item
                        event.currentTarget.classList.add('bg-light');
                        
                        // Update selected seller ID
                        const sellerId = parseInt(event.currentTarget.dataset.sellerid);
                        parent._selectedSellerId = sellerId;
                        
                        // Dispatch custom event for external listeners
                        parent.dispatchEvent(new CustomEvent('sellerSelected', {
                            detail: { sellerId: sellerId },
                            bubbles: true
                        }));
                    });
                });
                
                console.log('loaded @(nameof(_OfferListPartial)) from ' + e.type);
            }
        })(document.currentScript)
        //# sourceURL=OfferListPartial.js
    </script>
    @{ var iii = 0; }
    @foreach (var offer in Model.Offers){
        var editable = Model.ViewingSellerId == offer.SellerId;
        @* if(iii!=0){<div class="separator"></div>} *@
        <li class="offer-item hover-darken list-group-item d-flex" style="cursor: pointer;" data-sellerid="@(offer.SellerId)">
            <ul class="list-unstyled row g-1 d-flex">
                <li class="col-4  justify-content-start overflow-x-hidden align-content-center">
                    <button asp-page="/Seller" asp-route-Id="@(offer.SellerId)" class="btn btn-secondary">
                        @(offer.Seller.ShopName)
                    </button>
                </li>
                <li class="col-3  align-content-center">
                    <div class="row px-2 overflow-x-hidden">
                        <p id="stockValue@(offer.SellerId)" class="col-auto" style="font-size: small">@(offer.Stock)</p>
                        <p class="col-auto text-wrap" style="font-size: small; word-wrap: break-word">Ürün Stokta</p>
                    </div>
                </li>
                <li class="col-3 align-content-center">
                    <partial name="Shared/_ReviewStarPartial" model="new _ReviewStarPartial(){ Rating = offer.Stats.ReviewAverage.Value, RatingCount = (int?)offer.Stats.ReviewCount }"/>
                </li>
                @* @if (offer.Stats.RefundCount > 0){ *@
                @*     <li class="col-3 align-content-center"> *@
                @*         <p class="mx-2" style="font-size: small">@(offer.Stats.RefundCount) Kere İade Edildi</p> *@
                @*     </li>    *@
                @* } *@
                <li class="col-2 align-content-center align-self-end">
                    @await Html.PartialAsync("Shared/_ItemPricePartial", new CartItemAggregates(){
                        BasePrice = offer.Price,
                        DiscountedPrice = offer.Price * offer.Discount,
                        ProductId = offer.ProductId,
                        SellerId = offer.SellerId,
                        TotalDiscountPercentage = offer.Price!=0?(offer.Price / (offer.Price * offer.Discount)):0,
                        CouponDiscountedPrice = offer.Price * offer.Discount,
                    })
                </li>
            </ul>
        </li>
        {
            iii++;
        }
    }
</ul>
