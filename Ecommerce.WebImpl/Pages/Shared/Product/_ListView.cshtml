@model Ecommerce.WebImpl.Pages.Shared.Product._ListView

<ul class="list-group partial-parent">
    <script>
        ((s) => {
            document.addEventListener("DOMContentLoaded", load);
            s.parentElement.addEventListener("htmx:load", load);
            
            function load(e) {
                if (e.type === 'htmx:load') {
                    e.stopPropagation();
                }
                const parent = s.parentElement;
                parent._selected = null;
                parent.querySelectorAll('.product-item').forEach(item => {
                    item.addEventListener('click', function(event) {
                        // Remove previous selection
                        parent.querySelector('.bg-secondary-subtle')?.classList?.remove('bg-secondary-subtle');
                        event.currentTarget.classList.add('bg-secondary-subtle');
                        
                        const productId = parseInt(event.currentTarget.dataset.id);
                        parent._selectedProductId = productId;
                        parent._selected = item;
                        
                        // Dispatch custom event for external listeners
                        parent.dispatchEvent(new CustomEvent('productSelected', {
                            detail: { productId: productId },
                            bubbles: true
                        }));
                        
                        console.log('clicked product ' + productId);
                    });
                });
                console.log('loaded @(nameof(_ListView)) from ' + e.type);
            }
        })(document.currentScript)
        //# sourceURL=ListView.js
    </script>
    
    <!-- Header -->
    <li class="list-group-item py-2 px-3 bg-primary text-white">
        <div class="row g-1">
            <div class="col-3 d-flex align-items-center justify-content-center">
                <p class="fs-6 fw-bold mb-0">Resim</p>
            </div>
            <div class="col-3 d-flex align-items-center justify-content-center">
                <p class="fs-6 fw-bold mb-0">Ürün Adı</p>
            </div>
            <div class="col-2 d-flex align-items-center justify-content-center">
                <p class="fs-6 fw-bold mb-0">Kategori</p>
            </div>
            <div class="col-2 d-flex align-items-center justify-content-center">
                <p class="fs-6 fw-bold mb-0">Satış Sayısı</p>
            </div>
            <div class="col-2 d-flex align-items-center justify-content-center">
                <p class="fs-6 fw-bold mb-0">Değerlendirme</p>
            </div>
        </div>
    </li>
    
    <!-- Product Items -->
    @foreach (var Product in Model.Products)
    {
        <li class="product-item hover-darken list-group-item" style="cursor: pointer;" data-id="@Product.Id">
            <ul class="list-unstyled row g-1">
                <li class="col-3 d-flex align-items-center justify-content-center">
                    <img src="@(Utils.GetImageUrlOrDefault(Product.MainImage?.Data))" 
                         class="img-fluid rounded" 
                         style="max-height: 5em; max-width: 5em; object-fit: cover;" 
                         alt="Image of @Product.Name"/>
                </li>
                <li class="col-3 d-flex align-items-center">
                    <div class="text-truncate">
                        <p class="fs-5 fw-medium mb-0 text-truncate">@Product.Name</p>
                    </div>
                </li>
                <li class="col-2 d-flex align-items-center justify-content-center">
                    <div class="text-center">
                        <p class="fs-6 mb-0 text-truncate">@Model.Categories[Product.CategoryId]?.Name</p>
                    </div>
                </li>
                <li class="col-2 d-flex align-items-center justify-content-center">
                    <div class="text-center">
                        <p class="fs-6 mb-0">@Product.Stats.OrderCount</p>
                        <p class="text-muted small mb-0">Kez Satıldı</p>
                    </div>
                </li>
                <li class="col-2 d-flex align-items-center justify-content-center">
                    <div class="text-center">
                        @await Html.PartialAsync("Shared/_ReviewStarPartial", new _ReviewStarPartial(){
                            Rating = Product.Stats.RatingAverage,
                            RatingCount = (int)Product.Stats.ReviewCount
                        })
                    </div>
                </li>
            </ul>
        </li>
    }
</ul>
